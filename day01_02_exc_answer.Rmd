---
title: "Exercise 2"
author: "Manuel HÃ¤ndel"
date: "20 7 2020"
output: pdf_document
---

# 1. Install and load the R package ncdf4

```{r}
library(ncdf4)
```

# 2. Read in the netcdf and explore the structure of the data.

```{r}
prcp <- nc_open(file.path(getwd(), "day01/material/prcp_daily_2000-2000.nc"))
tmax <- nc_open(file.path(getwd(), "day01/material/tmax_daily_2000-2000.nc"))
tmin <- nc_open(file.path(getwd(), "day01/material/tmin_daily_2000-2000.nc"))
#dwsrf <- ...

str(tmin)

```


# 3. Plot a world map of maximum temperature at one selected day and check the orientation of the data.

```{r}
# extract geo coordinates
lon <- ncvar_get(tmax, "longitude")
nlon <- dim(lon)
head(lon)

lat <- ncvar_get(tmax, "latitude")
nlat <- dim(lat)
head(lat)

print(c(nlon, nlat))

# extract time

t <- ncvar_get(tmax_pgf, "time")
tunits <- ncatt_get(tmax, "time", "units")
nt <- dim(t)


# extract temperature

tmp.array <- ncvar_get(tmax, "tmax")
dlname <- ncatt_get(tmax, "tmax", "long_name")
dunits <- ncatt_get(tmax, "tmax", "units")
fillvalue <- ncatt_get(tmax, "tmax", "_FillValue")
dim(tmp.array)

m <- 1
tmp.slice <- tmp.array[, , m]

# print global view
library(RColorBrewer)
image(lon, lat, tmp.slice, col = rev(brewer.pal(10, "RdBu")))

```
# 4. Select now a subset of the data which is the time-series at the grid-cell containing Freiburg.
Plot the time series of precipitation and min/max temperature. Make sure axes and legend are labelled meaningfully with the correct unit. What was the maximum temperature in the year 2000?

```{r}

lat_fr <- 7.5
lon_fr <- 48.0
id_lat_fr <- which(lat == lat_fr)
id_lon_fr <- which(lon == (lon_fr-0.5))

# tmax for one year for freiburg
freiburg <- tmp.array[id_lon_fr, id_lat_fr,]

##### extract other data

prec.array <- ncvar_get(prcp, "prcp")
tmin.array <- ncvar_get(tmin, "tmin")
dswrf.array <- ncvar_get(dswrf, "dswrf")

#### arrays with data for freiburg

fr_tmax <- tmp.array[id_lon_fr, id_lat_fr,]
fr_tmin <- tmin.array[id_lon_fr, id_lat_fr,]
fr_prec <- prec.array[id_lon_fr, id_lat_fr,]
fr_dswrf <- dswrf.array[id_lon_fr, id_lat_fr,]


#### plot the time series of precipitation and min/max temperature
library(tidyverse)
data.frame(time, fr_tmax) %>% 
  ggplot(aes(time, fr_tmax)) + geom_line() +
  xlab("time (day)") + ylab("maximum temperature (K)") +
  labs(title="Maximum air temperature in Freiburg in 2000")

data.frame(time, fr_tmin) %>% 
  ggplot(aes(time, fr_tmin)) + geom_line() +
  xlab("time (day)") + ylab("minimum temperature (K)") +
  labs(title="Minimum air temperature in Freiburg in 2000")

data.frame(time, fr_prec) %>%   
  ggplot(aes(time, fr_prec)) + geom_line() +
  xlab("time (day)") + ylab("Precipitation (kg m-2 s-1)") +
  labs(title="Precipitation in Freiburg in 2000")
 

```


# 5. Calculate the average temperature from the minimum and maximum temperatures.
# 6. Aggregate the daily data to monthly values.
Use the adequate way of aggregating for the respective variable
(e.g. mean or sum). Create a data.frame with monthly values and a header containing Year, Month, Temp
(temperature in degree C), Precip (precipitation in mm). Check the annual precipitation sum and look up if
they make sense.
# 7. The data.frame contains a single year only. 
Search for climate projections for two different RCPs and
construct two artificial climate datasets of future scenarios covering 100 more years.
# 8. Construct a further artificial climate dataset
where of future climate scenario covering 100 more years is just
containing repeatedly the temperature and precipitation data of the year 2000 (reference scenario).
# 9. Store your datasets as tab-seperated .txt files
using meaningful filenames, you will need them for another
exercise.



